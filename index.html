<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å·¥å» ç¾å ´ç³»çµ±</title>
    <style>
        :root { --primary: #0056b3; --success: #28a745; --bg: #f4f6f8; --edit-bg: #e3f2fd; }
        body { font-family: -apple-system, Roboto, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; touch-action: manipulation; }
        
        .page { display: none; padding: 10px; }
        .page.active { display: block; }
        .card { background: #fff; padding: 15px; margin-bottom: 15px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .header { background: var(--primary); color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold;}
        
        .label { font-size: 13px; color: #666; display: block; margin-bottom: 5px; }
        .input-field { width: 100%; padding: 12px; font-size: 18px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; font-weight: bold; background: #fff;}
        .input-field:focus { border-color: var(--primary); outline: 2px solid #d1e7dd; }
        
        /* æŸ¥è©¢çµæœçš„ç·¨è¼¯æ¡†ç‰¹åˆ¥æ¨£å¼ */
        .edit-field { background-color: #fff; border: 2px solid #0056b3; color: #0056b3; }

        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

        /* æ•¸é‡å¤§æŒ‰éˆ• */
        .qty-input { width: 100%; font-size: 48px; font-weight: 800; color: var(--primary); text-align: center; border: none; background: transparent; margin: 5px 0; }
        .btn-group { display: flex; gap: 10px; }
        .btn-op { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 20px; font-weight: bold; cursor: pointer; color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .btn-minus { background: #dc3545; }
        .btn-plus { background: #198754; }
        .btn-plus-10 { background: #0d6efd; }

        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; height: 65px; z-index: 100; }
        .nav-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; font-size: 12px; color: #999; cursor: pointer; border-top: 4px solid transparent; }
        .nav-item.active { color: var(--primary); font-weight: bold; border-top-color: var(--primary); background: #f8f9fa; }
        .nav-icon { font-size: 24px; margin-bottom: 2px; }

        .btn-submit { width: 100%; background: var(--success); color: white; border: none; padding: 15px; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; }
        .btn-search { width: 100%; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 10px; font-size: 18px; margin-top: 10px; cursor: pointer; }
        .btn-save-edit { width: 100%; background: #ff9800; color: white; border: none; padding: 15px; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 15px; }

        #loading { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); color: white; justify-content: center; align-items: center; flex-direction: column; z-index: 2000; backdrop-filter: blur(2px); }
    </style>
</head>
<body>
    <div id="loading"><div style="font-size: 40px;">ğŸ”„</div><div style="margin-top:10px;">è™•ç†ä¸­...</div></div>

    <div id="page-report" class="page active">
        <div class="header">
            <div>ğŸ“ ç”Ÿç”¢å›å ±</div>
            <div class="clock">12:00</div>
        </div>

        <div class="card info-grid">
            <div><span class="label">ğŸ“¦ æ–™è™Ÿ</span><input type="text" id="part" class="input-field" value="A-774"></div>
            <div><span class="label">ğŸ”– æ‰¹è™Ÿ</span><input type="text" id="batch" class="input-field" value="LOT-01"></div>
            <div><span class="label">ğŸ“¥ é€²è²¨æ•¸é‡</span><input type="number" id="target" class="input-field" value="500" style="background:#fffbe6;"></div>
            <div><span class="label">ğŸ­ åº«å­˜æ•¸é‡</span><input type="number" id="stock" class="input-field" value="1200" style="color:#0056b3;"></div>
        </div>

        <div class="card" style="text-align:center;">
            <span class="label">âœ… å®Œæˆæ•¸é‡</span>
            <input type="number" id="qty" class="qty-input" value="0" onclick="this.select()">
            <div class="btn-group">
                <button class="btn-op btn-minus" onclick="adjQty('qty', -1)">-1</button>
                <button class="btn-op btn-plus" onclick="adjQty('qty', 1)">+1</button>
                <button class="btn-op btn-plus-10" onclick="adjQty('qty', 10)">+10</button>
            </div>
        </div>

        <div class="card">
            <span class="label">â±ï¸ é è¨ˆå®Œæˆ</span><input type="time" id="ect" class="input-field" value="17:00">
        </div>

        <button class="btn-submit" onclick="submitData('report')">ğŸ’¾ æäº¤å›å ±</button>
    </div>

    <div id="page-query" class="page">
        <div class="header" style="background:#666;">
            <div>ğŸ” æŸ¥è©¢èˆ‡ä¿®æ”¹</div>
            <div class="clock">12:00</div>
        </div>

        <div class="card">
            <span class="label">è¼¸å…¥æ–™è™ŸæŸ¥è©¢è³‡æ–™</span>
            <input type="text" id="q-part" class="input-field" placeholder="æ–™è™Ÿ (å¦‚ A-774)">
            <input type="text" id="q-batch" class="input-field" placeholder="æ‰¹è™Ÿ (é¸å¡«)" style="margin-top:10px;">
            <button class="btn-search" onclick="queryData()">ğŸ” è¼‰å…¥æœ€æ–°è³‡æ–™</button>
        </div>

        <div id="q-result" class="card" style="display:none; background: #e3f2fd; border: 2px solid #2196f3;">
            <h3 style="margin-top:0; color:#0056b3;">âœï¸ ä¿®æ”¹è³‡æ–™</h3>
            <p style="font-size:12px; color:#666;">(ç›´æ¥ä¿®æ”¹ä¸‹æ–¹æ•¸å€¼ï¼ŒæŒ‰æ©˜è‰²æŒ‰éˆ•å„²å­˜)</p>
            
            <div class="info-grid">
                <div><span class="label">ğŸ“¦ æ–™è™Ÿ</span><input type="text" id="res-part" class="input-field edit-field" readonly></div>
                <div><span class="label">ğŸ”– æ‰¹è™Ÿ</span><input type="text" id="res-batch" class="input-field edit-field"></div>
                <div><span class="label">ğŸ“¥ é€²è²¨æ•¸</span><input type="number" id="res-target" class="input-field edit-field"></div>
                <div><span class="label">ğŸ­ åº«å­˜æ•¸</span><input type="number" id="res-stock" class="input-field edit-field"></div>
                <div><span class="label">âœ… å®Œæˆæ•¸</span><input type="number" id="res-qty" class="input-field edit-field"></div>
                <div><span class="label">â±ï¸ é è¨ˆå®Œæˆ</span><input type="time" id="res-ect" class="input-field edit-field"></div>
            </div>

            <button class="btn-save-edit" onclick="submitData('query')">ğŸ’¾ å„²å­˜ä¿®æ”¹</button>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="goPage('report', this)"><div class="nav-icon">ğŸ“</div>å›å ±</div>
        <div class="nav-item" onclick="goPage('query', this)"><div class="nav-icon">ğŸ”</div>æŸ¥è©¢/ä¿®æ”¹</div>
    </div>

    <script>
        // ==========================================
        // âš ï¸ è«‹å‹™å¿…åœ¨æ­¤è²¼ä¸Šæ‚¨çš„ Google Script ç¶²å€
        // ==========================================
        const URL = "https://script.google.com/macros/s/AKfycbym1ulu27l_8gCThjYV6CbTUS8mv4CaXEGxCM-aNzO4aqNaghO1ib0XCnztCUOqCL0/exec"; 
        // ==========================================

        function updateClock() {
            const t = new Date().toLocaleTimeString('zh-TW', {hour12:false, hour:'2-digit', minute:'2-digit'});
            document.querySelectorAll('.clock').forEach(el => el.innerText = t);
        }
        setInterval(updateClock, 1000); updateClock();

        function goPage(page, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page-'+page).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            el.classList.add('active');
        }

        function adjQty(id, n) {
            let el = document.getElementById(id);
            let v = parseInt(el.value) || 0;
            if(v + n >= 0) el.value = v + n;
        }

        function toggleLoad(show) { document.getElementById('loading').style.display = show ? 'flex' : 'none'; }

        // é€šç”¨æäº¤åŠŸèƒ½ (æ”¯æ´ Report é é¢èˆ‡ Query ä¿®æ”¹é é¢)
        function submitData(source) {
            if(!URL || URL.includes("è²¼ä¸Š")) return alert("è«‹å…ˆè¨­å®šç¶²å€ï¼");
            
            toggleLoad(true);
            let payload = {};

            if (source === 'report') {
                // å¾å›å ±é é¢æŠ“è³‡æ–™
                payload = {
                    partNo: document.getElementById('part').value,
                    batchNo: document.getElementById('batch').value,
                    target: document.getElementById('target').value,
                    qty: document.getElementById('qty').value,
                    stock: document.getElementById('stock').value,
                    ect: document.getElementById('ect').value
                };
            } else {
                // å¾æŸ¥è©¢ä¿®æ”¹é é¢æŠ“è³‡æ–™
                payload = {
                    partNo: document.getElementById('res-part').value,
                    batchNo: document.getElementById('res-batch').value,
                    target: document.getElementById('res-target').value,
                    qty: document.getElementById('res-qty').value,
                    stock: document.getElementById('res-stock').value,
                    ect: document.getElementById('res-ect').value
                };
            }
            
            fetch(URL, {
                method: "POST", mode: "no-cors",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(payload)
            }).then(() => {
                toggleLoad(false); 
                alert(source === 'report' ? "âœ… å›å ±æˆåŠŸï¼" : "âœ… ä¿®æ”¹å·²å„²å­˜ï¼");
                if(source === 'query') {
                    document.getElementById('q-result').style.display = 'none'; // ä¿®æ”¹å®Œéš±è—
                }
            }).catch(e => { toggleLoad(false); alert("é€£ç·šå¤±æ•—ï¼š" + e); });
        }

        // æŸ¥è©¢åŠŸèƒ½
        function queryData() {
            if(!URL || URL.includes("è²¼ä¸Š")) return alert("è«‹å…ˆè¨­å®šç¶²å€ï¼");
            
            let p = document.getElementById('q-part').value.trim();
            let b = document.getElementById('q-batch').value.trim();
            if(!p) return alert("è«‹è¼¸å…¥æ–™è™Ÿ");

            toggleLoad(true);
            document.getElementById('q-result').style.display = 'none';

            fetch(`${URL}?partNo=${encodeURIComponent(p)}&batchNo=${encodeURIComponent(b)}`)
            .then(r => r.json())
            .then(data => {
                toggleLoad(false);
                if(data.found) {
                    // å°‡æŸ¥åˆ°çš„è³‡æ–™å¡«å…¥ã€Œä¿®æ”¹æ¡†ã€
                    document.getElementById('res-part').value = p; // æ–™è™Ÿ
                    document.getElementById('res-batch').value = data.batch; // æ‰¹è™Ÿ
                    document.getElementById('res-target').value = data.target; // é€²è²¨
                    document.getElementById('res-stock').value = data.stock; // åº«å­˜
                    document.getElementById('res-qty').value = data.qty; // å®Œæˆæ•¸é‡
                    document.getElementById('res-ect').value = data.ect; // æ™‚é–“

                    // é¡¯ç¤ºä¿®æ”¹å€å¡Š
                    document.getElementById('q-result').style.display = 'block';
                } else {
                    alert("âŒ æŸ¥ç„¡æ­¤æ–™è™Ÿè³‡æ–™");
                }
            }).catch(e => {
                toggleLoad(false); 
                alert("æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¢ºèª Apps Script å·²ç™¼å¸ƒã€Œæ–°ç‰ˆæœ¬ã€\n" + e);
            });
        }
    </script>
</body>
</html>
